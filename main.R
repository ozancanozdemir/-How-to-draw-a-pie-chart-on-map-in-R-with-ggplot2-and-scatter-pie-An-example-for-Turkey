library(ggplot2)
library(sf)
library(scatterpie)

tr_data <- data.frame(
  il = c("Adana", "Adiyaman", "Afyonkarahisar", "Agri", "Aksaray", "Amasya",
         "Ankara", "Antalya", "Ardahan", "Artvin", "Aydin", "Balikesir", 
         "Bartin", "Batman", "Bayburt", "Bilecik", "Bingöl", "Bitlis", 
         "Bolu", "Burdur", "Bursa", "Çanakkale", "Çankiri", "Çorum", 
         "Denizli", "Diyarbakir", "Düzce", "Edirne", "Elazig", "Erzincan", 
         "Erzurum", "Eskişehir", "Gaziantep", "Giresun", "Gümüşhane", "Hakkari",
         "Hatay", "Iğdir", "Isparta", "İstanbul", "İzmir", "Kahramanmaraş", "Karabük", 
         "Karaman", "Kars", "Kastamonu", "Kayseri", "Kilis", "Kirikkale", "Kirklareli", 
         "Kirşehir", "Kocaeli", "Konya", "Kütahya", "Malatya", "Manisa", "Mardin", 
         "Mersin", "Muğla", "Muş", "Nevşehir", "Niğde", "Ordu", "Osmaniye", "Rize", 
         "Sakarya", "Samsun", "Şanliurfa", "Siirt", "Sinop", "Şirnak", "Sivas",
         "Tekirdağ", "Tokat", "Trabzon", "Tunceli", "Uşak", "Van", 
         "Yalova", "Yozgat", "Zonguldak"),
  at_least_university_graduate = c(16.8676012, 13.6572817, 13.7884803, 9.90920692, 13.2562126, 17.0805155, 27.7573632, 20.5287251, 13.6567156, 18.4381204, 17.8678803, 18.8957506,
                                   14.1604553, 12.977696, 16.6110582, 17.1629683, 14.2964005, 12.1532789,
                                   18.4502393, 17.6679186, 18.4727864, 21.2007129, 14.5465479, 14.4830807,
                                   17.6257227, 12.9768574, 16.0190168, 18.0750398, 17.783513, 19.2115029,
                                   15.9928723, 22.819271, 12.9954402, 16.6665894, 16.1343263, 13.5535846,
                                   14.0785512, 13.6316172, 20.1732183, 23.3156671, 22.5488314, 13.5278245, 19.2273596,
                                   15.9122193, 13.8476215, 14.4691915, 17.6547694, 15.2055778, 16.8034661, 18.1689733,
                                   17.1328434, 19.7994138, 16.1027868, 15.4983519, 17.5253791, 14.9880936, 11.3756689,
                                   17.6003597, 22.343548, 9.98344813, 15.9219028, 13.7984752, 14.8249171, 15.9094298, 18.0992486,
                                   16.9164545, 17.7171067, 8.88018377, 13.3325922, 14.6370252, 11.5692743, 16.0412803,
                                   16.5076458, 14.9653507, 19.5836861, 21.490713, 15.6790883, 11.4533382,
                                   20.6249712, 13.0927575, 15.2909335),
  below = c(83.1323988, 86.3427183, 86.2115197, 90.0907931, 86.7437874, 82.9194845,
            72.2426368, 79.4712749, 86.3432844, 81.5618796, 82.1321197, 81.1042494,
            85.8395447, 87.022304, 83.3889418, 82.8370317, 85.7035995, 87.8467211,
            81.5497607, 82.3320814, 81.5272136, 78.7992871, 85.4534521, 85.5169193,
            82.3742773, 87.0231426, 83.9809832, 81.9249602, 82.216487, 80.7884971,
            84.0071277, 77.180729, 87.0045598, 83.3334106, 83.8656737, 86.4464154,
            85.9214488, 86.3683828, 79.8267817, 76.6843329, 77.4511686, 86.4721755, 80.7726404,
            84.0877807, 86.1523785, 85.5308085, 82.3452306, 84.7944222, 83.1965339, 81.8310267,
            82.8671566, 80.2005862, 83.8972132, 84.5016481, 82.4746209, 85.0119064, 88.6243311,
            82.3996403, 77.656452, 90.0165519, 84.0780972, 86.2015248, 85.1750829, 84.0905702, 81.9007514,
            83.0835455, 82.2828933, 91.1198162, 86.6674078, 85.3629748, 88.4307257, 83.9587197,
            83.4923542, 85.0346493, 80.4163139, 78.509287, 84.3209117, 88.5466618,
            79.3750288, 86.9072425, 84.7090665),
  lat = c(37.00, 37.76, 38.76, 39.72, 38.37, 40.65, 
          39.92, 36.88, 41.11, 41.18, 37.84, 39.65, 
          41.63, 37.89, 40.27, 40.15, 38.89, 38.40, 
          40.74, 37.72, 40.18, 40.15, 40.60, 40.55, 
          37.77, 37.91, 40.84, 41.67, 38.68, 39.75, 
          39.90, 39.77, 37.07, 40.92, 40.46, 37.58, 
          36.25, 39.92, 37.76, 41.01, 38.42, 37.31, 40.56, 
          37.18, 40.60, 41.38, 38.72, 36.72, 39.84, 41.73, 
          39.14, 40.77, 37.87, 39.42, 38.35, 38.61, 37.31, 
          36.81, 37.22, 38.74, 38.62, 37.97, 40.98, 37.07, 41.02, 
          40.76, 41.29, 37.16, 37.93, 42.03, 37.52, 39.75, 
          40.98, 40.32, 41.00, 39.11, 38.68, 38.50, 
          40.65, 39.82, 41.46),
  long = c(35.32, 38.28, 30.54, 43.05, 33.99, 35.83, 
           32.85, 30.70, 42.11, 41.82, 27.84, 27.89, 
           32.11, 41.13, 40.23, 29.98, 40.50, 42.11, 
           31.61, 30.29, 29.07, 26.41, 33.62, 34.96, 
           29.09, 40.24, 31.16, 26.56, 39.23, 39.49, 
           41.27, 30.52, 37.38, 38.39, 39.48, 43.74, 
           36.18, 44.04, 30.56, 28.98, 27.14, 36.93, 32.60, 
           33.22, 43.10, 33.78, 35.49, 37.11, 33.51, 27.23, 
           34.17, 29.99, 32.48, 29.99, 38.31, 27.43, 40.72, 
           34.63, 28.36, 41.49, 34.71, 34.68, 37.88, 36.25, 40.52, 
           30.40, 36.33, 38.79, 41.94, 35.16, 42.11, 37.02, 
           27.52, 36.56, 39.73, 39.55, 29.41, 43.38, 
           29.27, 34.81, 31.79)
)

head(tr_data)

st_data_turkey <- st_read("https://geodata.ucdavis.edu/gadm/gadm4.1/json/gadm41_TUR_1.json")
head(st_data_turkey)

ggplot(data = st_data_turkey) +
  geom_sf() +
  geom_scatterpie(aes(x = long, y = lat),
                  data = tr_data,
                  cols = c("at_least_university_graduate", "below")) +
  scale_fill_manual(values = c("#FF9999", "#66B3FF"),
                    labels = c("At least university graduate", "Below university graduate")) +
  labs(title = "Turkey Map with Pie Chart",
       subtitle = "Education Level by Province",
       caption = "Source: TSI | Ozancan Ozdemir") +
  theme_void() +
  geom_text(aes(x = long, y = lat, label = il),
            data = tr_data, size = 2, color = "black") +
  theme(plot.title = element_text(hjust = 0.5, size = 20),
        plot.subtitle = element_text(hjust = 0.5, size = 15),
        plot.caption = element_text(hjust = 0.5, size = 10),
        legend.position = "top",
        legend.title = element_blank())
